<div class="container">

  <!-- HEADER DEL DÃA + ENERGÃA -->
  <header class="header-dia">
    <h1>{{ rutinaGenerada ? rutina.dia : 'Muscle RPG - Rutinas' }}</h1>

    <div class="energia" *ngIf="rutinaGenerada">
      EnergÃ­a: <strong>{{ energiaRestante() }} / {{ rutina.energiaMax }}</strong>
    </div>

    <div class="usuario-info">
      <p>Usuario: <strong>{{ userName }}</strong></p>
      <p>Nivel: <strong>{{ userLevel }}</strong></p>
    </div>
  </header>

  <!-- ERROR MESSAGE -->
  <div class="error-message" *ngIf="errorMessage" style="background: #ff4444; color: white; padding: 1rem; margin: 1rem; border-radius: 8px;">
    âš ï¸ {{ errorMessage }}
  </div>

  <!-- SELECTOR DE DÃAS (cuando hay rutina semanal) -->
  <div class="selector-dias" *ngIf="rutinaGenerada && rutinaSemanal.length > 0" style="margin: 1.5rem auto; max-width: 800px;">
    <div style="display: flex; gap: 0.5rem; justify-content: center; flex-wrap: wrap; padding: 0 1rem;">
      <button 
        *ngFor="let r of rutinaSemanal; let i = index"
        (click)="cambiarDia(i)"
        [class.activo]="i === diaActual"
        class="btn-dia"
        [style.background]="i === diaActual ? 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)' : 'transparent'"
        [style.color]="i === diaActual ? 'white' : '#667eea'"
        [style.border-color]="i === diaActual ? 'transparent' : '#667eea'">
        {{ diasSemana[i] }}
        <span style="font-size: 0.75rem; display: block; margin-top: 0.25rem;">
          {{ r.ejercicios.length > 0 ? 'ğŸ’ª ' + r.ejercicios.length + ' ej.' : 'ğŸ˜´ Descanso' }}
        </span>
      </button>
    </div>
  </div>

  <!-- BOTÃ“N GENERAR RUTINA (cuando no hay rutina generada) -->
  <div class="generar-rutina" *ngIf="!rutinaGenerada && !loading">
    <div class="card-generar">
      <h2>ğŸ“… Rutina Semanal</h2>
      <p>Genera tu rutina de entrenamiento personalizada optimizada por algoritmo de grafos DAG</p>
      
      <div class="info-stats" *ngIf="user">
        <div class="stat-item">
          <span class="stat-label">Stamina disponible:</span>
          <span class="stat-value">{{ user.staminaActual || 100 }} / {{ user.staminaMaxima || 100 }}</span>
        </div>
        <div class="stat-item">
          <span class="stat-label">Nivel:</span>
          <span class="stat-value">{{ user.nivel || 1 }}</span>
        </div>
        <div class="stat-item">
          <span class="stat-label">Tiempo disponible:</span>
          <span class="stat-value">120 minutos</span>
        </div>
      </div>

      <button class="btn-generar-rutina" (click)="generarRutinaDiaria()">
        ğŸš€ GENERAR RUTINA
      </button>

      <div class="hint">
        <small>El sistema calcularÃ¡ la rutina Ã³ptima basada en tu perfil, nivel y estado actual</small>
      </div>
    </div>
  </div>

  <!-- LOADING STATE -->
  <div class="loading" *ngIf="loading" style="text-align: center; padding: 3rem;">
    <div class="spinner" style="border: 4px solid #f3f3f3; border-top: 4px solid #3498db; border-radius: 50%; width: 50px; height: 50px; animation: spin 1s linear infinite; margin: 0 auto;"></div>
    <p style="margin-top: 1rem; color: #666;">Generando tu rutina Ã³ptima... ğŸ¤–</p>
  </div>

<!-- ESTADO INICIAL: ENTRENAMIENTO O DESCANSO -->
<div class="estado-inicial" *ngIf="rutinaGenerada && !sesionActiva && !sesionFinalizada">
  <div class="card-inicial">

    <!-- CASO 1: HAY EJERCICIOS â†’ RUTINA NORMAL -->
    <div *ngIf="rutina.ejercicios.length > 0">
      <h2>Rutina Optimizada</h2>
      <p *ngIf="rutina.descripcion">{{ rutina.descripcion }}</p>
      
      <div class="muscle-groups" *ngIf="rutina.muscleGroups && rutina.muscleGroups.length > 0" 
           style="background: linear-gradient(135deg, #667eea22 0%, #764ba222 100%); padding: 1rem; border-radius: 8px; margin: 1rem 0;">
        <strong style="color: #667eea;">ğŸ¯ Grupos musculares:</strong>
        <span style="margin-left: 0.5rem; font-size: 1.1rem;">{{ rutina.muscleGroups.join(' + ') }}</span>
      </div>

      <div class="stats-rutina" *ngIf="rutina.xpTotalEstimado">
        <div class="stat">
          <span class="label">XP Estimado:</span>
          <span class="value">{{ rutina.xpTotalEstimado | number:'1.0-0' }}</span>
        </div>
        <div class="stat">
          <span class="label">Ejercicios:</span>
          <span class="value">{{ rutina.ejercicios.length }}</span>
        </div>
        <div class="stat">
          <span class="label">Tiempo:</span>
          <span class="value">{{ rutina.tiempoTotal || rutina.tiempoPlaneado }} min</span>
        </div>
      </div>

      <div class="info-energia">
        <strong>EnergÃ­a disponible:</strong>
        <span class="valor-energia" [class.baja]="energiaRestante() < 30">
          {{ energiaRestante() }} / {{ rutina.energiaMax }}
        </span>
      </div>

      <!-- Resumen de cargas -->
      <div class="resumen-cargas" *ngIf="rutina.ejercicios && rutina.ejercicios.length > 0">
        <h3 style="font-size: 1rem; color: #60a5fa; margin-bottom: 12px;">ğŸ“Š Resumen de Cargas</h3>
        <div class="cargas-stats">
          <div class="carga-stat">
            <span class="carga-label">Ejercicios con peso:</span>
            <span class="carga-value">{{ contarEjerciciosConPeso() }} / {{ rutina.ejercicios.length }}</span>
          </div>
          <div class="carga-stat" *ngIf="obtenerPesoPromedio() > 0">
            <span class="carga-label">Peso promedio:</span>
            <span class="carga-value peso-destacado">{{ obtenerPesoPromedio() | number:'1.1-1' }}kg</span>
          </div>
          <div class="carga-stat">
            <span class="carga-label">RIR promedio:</span>
            <span class="carga-value">{{ obtenerRIRPromedio() | number:'1.0-0' }}</span>
          </div>
        </div>
      </div>

      <button class="btn-comenzar" (click)="comenzarEntrenamiento()">
        ğŸ’ª COMENZAR ENTRENAMIENTO
      </button>
    </div>

    <!-- CASO 2: DÃA DE DESCANSO â†’ MENSAJE ESPECIAL -->
    <div *ngIf="rutina.ejercicios.length === 0" style="text-align: center; padding: 2rem 1rem;">
      <div style="font-size: 4rem; margin-bottom: 1rem;">ğŸ˜´</div>
      <h2 style="color: #667eea; margin-bottom: 1rem;">Â¡DÃ­a de Descanso!</h2>
      
      <p style="font-size: 1.1rem; max-width: 600px; margin: 0 auto 1.5rem; line-height: 1.6; color: #12d1eb;">
        Hoy no hay entrenamiento programado. Tu cuerpo necesita recuperarse para rendir al mÃ¡ximo maÃ±ana.
      </p>

      <div style="background: linear-gradient(135deg, #667eea11, #764ba211); padding: 0.4rem; border-radius: 10px; margin: 1.5rem auto; max-width: 600px;">
        <p style="margin: 1rem 0 0; font-style: italic; color: #667eea;">Recuerda: los mÃºsculos crecen mientras descansas ğŸ’ª
        </p>
      </div>

      <p style="margin-top: 2rem; color: #888;">
        MaÃ±ana volvemos con todo. Â¡Recarga energÃ­as!
      </p>
    </div>

  </div>
</div>

  <!-- DURANTE EL ENTRENAMIENTO -->
  <div class="durante" *ngIf="sesionActiva">
    <button class="btn-finalizar" (click)="finalizarEntrenamiento()">
      Finalizar entrenamiento
    </button>
  </div>

  <!-- LISTA DE EJERCICIOS -->
  <div class="ejercicios" *ngIf="sesionActiva || sesionFinalizada">
    <div
      *ngFor="let ej of rutina.ejercicios; let i = index"
      class="ejercicio"
      [class.hecho]="ej.hecho"
      (click)="marcarEjercicio(ej, i)"
      [style.cursor]="sesionFinalizada ? 'default' : 'pointer'"
      [style.opacity]="sesionFinalizada && !ej.hecho ? 0.5 : 1">

      <div class="izq">
        <div class="num">{{ i + 1 }}</div>
      </div>

      <div class="centro">
        <div class="nombre">{{ ej.nombre }}</div>
        <div class="detalle">
          {{ ej.sets }}Ã—{{ ej.reps }} rep. â€¢ 
          <span class="peso-destacado" *ngIf="ej.peso && ej.peso > 0">ğŸ’ª {{ ej.peso }}kg</span>
          <span *ngIf="!ej.peso || ej.peso === 0" style="color: #ff6b6b;">âš ï¸ Sin peso asignado</span>
          â€¢ RIR {{ ej.rir || 2 }} â€¢ 
          <span *ngIf="ej.intensidad" class="intensidad-tag">{{ ej.intensidad }}% 1RM</span>
          â‰ˆ{{ ej.tiempo }} min â€¢ XP {{ ej.estimuloXP | number:'1.0-0' }}
        </div>
        <div class="notas-ejercicio" *ngIf="ej.notas" style="font-size: 0.7rem; color: #999; margin-top: 0.25rem; font-style: italic;">
          ğŸ“ {{ ej.notas }}
        </div>
        <div class="muscles" *ngIf="ej.targetMuscles && ej.targetMuscles.length > 0" 
             style="font-size: 0.75rem; color: #667eea; margin-top: 0.25rem;">
          ğŸ¯ {{ ej.targetMuscles.join(', ') }}
        </div>
      </div>

      <div class="check" *ngIf="ej.hecho">âœ“</div>
    </div>
  </div>

  <!-- RESUMEN FINAL -->
  <div class="resumen" *ngIf="sesionFinalizada">
    <h3>Entrenamiento completado</h3>

    <p>Tiempo dedicado: <strong>{{ tiempoRealMinutos }} min</strong></p>

    <p>Ejercicios completados:
      <strong>{{ ejerciciosCompletados() }} / {{ rutina.ejercicios.length }}</strong>
    </p>

    <p>EnergÃ­a consumida:
      <strong>{{ energiaGastada }}</strong>
    </p>

    <p>EnergÃ­a restante:
      <strong>{{ energiaRestante() }}</strong>
    </p>
  </div>

</div>
