<div class="rpg-container">
  <div class="header">
    <h2>âš”ï¸ ClasificaciÃ³n del Aventurero</h2>
    <p class="subtitle">Sistema de Perfilamiento Multifactorial</p>
  </div>

  <div class="progress-indicator" *ngIf="!result">
    <div class="step" [class.active]="currentStep >= 1" [class.completed]="currentStep > 1">
      <span class="step-number">1</span>
      <span class="step-label">BiometrÃ­a</span>
    </div>
    <div class="progress-line" [class.completed]="currentStep > 1"></div>
    <div class="step" [class.active]="currentStep >= 2" [class.completed]="currentStep > 2">
      <span class="step-number">2</span>
      <span class="step-label">Experiencia</span>
    </div>
    <div class="progress-line" [class.completed]="currentStep > 2"></div>
    <div class="step" [class.active]="currentStep >= 3" [class.completed]="currentStep > 3">
      <span class="step-number">3</span>
      <span class="step-label">Salud</span>
    </div>
    <div class="progress-line" [class.completed]="currentStep > 3"></div>
    <div class="step" [class.active]="currentStep >= 4">
      <span class="step-number">4</span>
      <span class="step-label">ComposiciÃ³n</span>
    </div>
  </div>
  
  <form [formGroup]="profileForm" (ngSubmit)="onSubmit()" *ngIf="!result">
    
    <div class="section" *ngIf="currentStep === 1">
      <h3>ğŸ“Š Paso 1: Datos BiomÃ©tricos</h3>
      <p class="section-description">InformaciÃ³n bÃ¡sica para calcular tu Ã­ndice de masa corporal y composiciÃ³n</p>
      
      <div class="form-row">
        <div class="form-group">
          <label>GÃ©nero BiolÃ³gico</label>
          <select formControlName="gender">
            <option value="1">Masculino</option>
            <option value="0">Femenino</option>
          </select>
        </div>

        <div class="form-group">
          <label>Peso (kg)</label>
          <input type="number" formControlName="weight" placeholder="Ingresa tu peso en kg" min="30" max="300" step="0.1">
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label>Estatura (cm)</label>
          <input type="number" formControlName="height" placeholder="Ingresa tu estatura en centÃ­metros" min="100" max="250">
        </div>
      </div>
    </div>

    <div class="section" *ngIf="currentStep === 2">
      <h3>ğŸ’ª Paso 2: Experiencia de Entrenamiento</h3>
      <p class="section-description">Tu historial determina el puntaje de experiencia (P<sub>exp</sub>)</p>
      
      <div class="form-group">
        <label>Â¿CuÃ¡ntos meses has entrenado con pesas/resistencia?</label>
        <input type="number" formControlName="experienceMonths" placeholder="0 si eres principiante" min="0">
        <div class="experience-guide">
          <div class="guide-item">
            <span class="badge">5 pts</span>
            <span>Menos de 3 meses</span>
          </div>
          <div class="guide-item">
            <span class="badge">15 pts</span>
            <span>3-6 meses</span>
          </div>
          <div class="guide-item">
            <span class="badge">30 pts</span>
            <span>6-12 meses</span>
          </div>
          <div class="guide-item">
            <span class="badge">45 pts</span>
            <span>1-2 aÃ±os</span>
          </div>
          <div class="guide-item">
            <span class="badge">60 pts</span>
            <span>MÃ¡s de 2 aÃ±os</span>
          </div>
        </div>
      </div>

      <div class="form-group">
        <label>Nivel de Actividad FÃ­sica (SegÃºn OMS)</label>
        <select formControlName="activityLevel">
          <option value="sedentary">ğŸª‘ Sedentario - Poco o ningÃºn ejercicio (0 pts)</option>
          <option value="active">ğŸš¶ Activo - Cumple mÃ­nimos recomendados (10 pts)</option>
          <option value="sport">ğŸƒ Deportista - Entrena regularmente (20 pts)</option>
        </select>
        <span class="hint">Puntaje de Actividad (P<sub>act</sub>)</span>
      </div>
    </div>

    <!-- PASO 3: CONDICIONES DE SALUD -->
    <div class="section" *ngIf="currentStep === 3">
      <h3>ğŸ¥ Paso 3: EvaluaciÃ³n de Salud</h3>
      <p class="section-description">Factor de seguridad (Î´<sub>salud</sub>) para personalizar tu rutina</p>
      
      <div class="health-check">
        <div class="checkbox-group">
          <input type="checkbox" id="medicalConditions" formControlName="hasMedicalConditions">
          <label for="medicalConditions">
            <strong>Tengo condiciones mÃ©dicas de riesgo</strong>
            <span class="checkbox-description">
              âš ï¸ HipertensiÃ³n no controlada, diabetes sin tratamiento, problemas cardÃ­acos, lesiones graves recientes
            </span>
          </label>
        </div>
        
        <div class="info-box" *ngIf="profileForm.get('hasMedicalConditions')?.value">
          <span class="icon">âš ï¸</span>
          <div>
            <strong>Factor de Seguridad Activado</strong>
            <p>Tu perfil serÃ¡ ajustado para priorizar tu seguridad (Î´ = 0). Te recomendamos consultar con un mÃ©dico antes de iniciar.</p>
          </div>
        </div>

        <div class="info-box success" *ngIf="!profileForm.get('hasMedicalConditions')?.value">
          <span class="icon">âœ…</span>
          <div>
            <strong>Sin Restricciones MÃ©dicas</strong>
            <p>Perfil sin limitaciones de salud (Î´ = 1). El sistema calcularÃ¡ tu capacidad total.</p>
          </div>
        </div>
      </div>
    </div>

    <div class="section" *ngIf="currentStep === 4">
      <h3>ğŸ“ Paso 4: ComposiciÃ³n Corporal (Opcional)</h3>
      <p class="section-description">Mejora la precisiÃ³n del cÃ¡lculo con datos antropomÃ©tricos</p>
      
      <div class="form-group">
        <label>MÃ©todo de MediciÃ³n</label>
        <select formControlName="metodoMedicion" (change)="onMetodoChange($event)">
          <option value="estimacion">ğŸ“Š EstimaciÃ³n por IMC (MÃ©todo Deurenberg)</option>
          <option value="conocido">âœï¸ Tengo mi % de grasa corporal medido</option>
          <option value="7pliegues">ğŸ¯ MediciÃ³n de 7 Pliegues CutÃ¡neos (Gold Standard)</option>
        </select>
      </div>

      <div class="form-group" *ngIf="profileForm.get('metodoMedicion')?.value === 'conocido'">
        <label>Porcentaje de Grasa Corporal (%)</label>
        <input type="number" formControlName="knownBodyFat" placeholder="Ej: 18.5" step="0.1" min="3" max="60">
        <span class="hint">Si lo tienes de una mediciÃ³n con bioimpedancia, plicÃ³metro, etc.</span>
      </div>

      <div class="pliegues-container" *ngIf="profileForm.get('metodoMedicion')?.value === '7pliegues'">
        <div class="pliegues-intro">
          <span class="badge gold">Gold Standard</span>
          <p>Ingresa las mediciones de los 7 pliegues cutÃ¡neos en <strong>milÃ­metros (mm)</strong>. Se utilizarÃ¡ la ecuaciÃ³n de Jackson & Pollock + Siri.</p>
        </div>

        <div class="pliegues-grid">
          <div class="form-group">
            <label>ğŸ’ª TrÃ­ceps (mm)</label>
            <input type="number" formControlName="pliegue_triceps" placeholder="Ej: 12" step="0.5" min="1" max="50">
          </div>

          <div class="form-group">
            <label>ğŸ¦´ Deltoides/Clavicular (mm)</label>
            <input type="number" formControlName="pliegue_deltoides" placeholder="Ej: 10" step="0.5" min="1" max="50">
          </div>

          <div class="form-group">
            <label>ğŸ’“ Pectoral (mm)</label>
            <input type="number" formControlName="pliegue_pectoral" placeholder="Ej: 8" step="0.5" min="1" max="50">
          </div>

          <div class="form-group">
            <label>âš¡ Cintura (mm)</label>
            <input type="number" formControlName="pliegue_cintura" placeholder="Ej: 15" step="0.5" min="1" max="50">
          </div>

          <div class="form-group">
            <label>ğŸ‘ GlÃºteo (mm)</label>
            <input type="number" formControlName="pliegue_gluteo" placeholder="Ej: 14" step="0.5" min="1" max="50">
          </div>

          <div class="form-group">
            <label>ğŸ¦µ CuÃ¡driceps/Vasto Externo (mm)</label>
            <input type="number" formControlName="pliegue_cuadriceps" placeholder="Ej: 16" step="0.5" min="1" max="50">
          </div>

          <div class="form-group">
            <label>ğŸ¦¿ Gastrocnemio/Gemelar (mm)</label>
            <input type="number" formControlName="pliegue_gastronemio" placeholder="Ej: 11" step="0.5" min="1" max="50">
          </div>
        </div>
      </div>

      <div class="info-box" *ngIf="profileForm.get('metodoMedicion')?.value === 'estimacion'">
        <span class="icon">â„¹ï¸</span>
        <div>
          <strong>EstimaciÃ³n AutomÃ¡tica</strong>
          <p>El sistema calcularÃ¡ tu porcentaje de grasa corporal usando la fÃ³rmula de Deurenberg basada en IMC, edad y gÃ©nero.</p>
        </div>
      </div>
    </div>

    <div class="navigation-buttons">
      <button type="button" class="btn-secondary" (click)="prevStep()" *ngIf="currentStep > 1">
        â† Anterior
      </button>
      
      <button type="button" class="btn-rpg" (click)="nextStep()" 
              *ngIf="currentStep < totalSteps" 
              [disabled]="!canProceedToNextStep()">
        Siguiente â†’
      </button>
      
      <button type="submit" class="btn-rpg submit" *ngIf="currentStep === totalSteps">
        ğŸ¯ Calcular Mi Perfil RPG
      </button>
    </div>
  </form>

  <div *ngIf="result" class="result-container">
    <div class="result-header">
      <h3>âš”ï¸ ClasificaciÃ³n Completa</h3>
      <p>Tu perfil ha sido analizado mediante el algoritmo multifactorial</p>
    </div>

    <div class="class-card">
      <div class="class-badge-large" [class.basico]="result.level === 'BÃ¡sico'" 
                                      [class.intermedio]="result.level === 'Intermedio'"
                                      [class.avanzado]="result.level === 'Avanzado'">
        <span class="level-icon">{{ result.level === 'BÃ¡sico' ? 'ğŸ›¡ï¸' : result.level === 'Intermedio' ? 'âš”ï¸' : 'ğŸ‘‘' }}</span>
        <span class="level-name">{{ result.level | uppercase }}</span>
      </div>
    </div>

    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-label">Score RPG (S<sub>RPG</sub>)</div>
        <div class="stat-value">{{ result.sRpg | number:'1.0-2' }}</div>
        <div class="stat-description">Puntaje de capacidad total</div>
      </div>

      <div class="stat-card">
        <div class="stat-label">Grasa Corporal</div>
        <div class="stat-value">{{ result.estimatedBodyFat | number:'1.0-1' }}%</div>
        <div class="stat-description">{{ result.metodoCalculoPGC }}</div>
      </div>

      <div class="stat-card">
        <div class="stat-label">Multiplicador (Î¼<sub>comp</sub>)</div>
        <div class="stat-value">{{ result.compositionMultiplier | number:'1.0-2' }}</div>
        <div class="stat-description">Factor de composiciÃ³n</div>
      </div>
    </div>

    <div class="parameters-section">
      <h4>ğŸ“‹ ParÃ¡metros de Entrenamiento</h4>
      
      <div class="parameters-grid">
        <div class="parameter-card">
          <span class="param-icon">ğŸ“…</span>
          <div class="param-content">
            <div class="param-label">Frecuencia Semanal</div>
            <div class="param-value">{{ result.frecuenciaSemanal.min }} - {{ result.frecuenciaSemanal.max }} dÃ­as</div>
          </div>
        </div>

        <div class="parameter-card">
          <span class="param-icon">ğŸ¯</span>
          <div class="param-content">
            <div class="param-label">RIR Target</div>
            <div class="param-value">{{ result.rirTarget.min }}{{ result.rirTarget.max !== result.rirTarget.min ? ' - ' + result.rirTarget.max : '' }} reps en reserva</div>
          </div>
        </div>

        <div class="parameter-card">
          <span class="param-icon">ğŸ’ª</span>
          <div class="param-content">
            <div class="param-label">Carga Estimada</div>
            <div class="param-value">{{ result.cargaEstimada.min }} - {{ result.cargaEstimada.max }}% 1RM</div>
          </div>
        </div>
      </div>
    </div>

    <div class="details-section">
      <h4>ğŸ“Š Desglose del CÃ¡lculo</h4>
      <div class="details-grid">
        <div class="detail-item">
          <span class="detail-label">Experiencia (P<sub>exp</sub>):</span>
          <span class="detail-value">{{ result.puntajeExperiencia }} pts</span>
        </div>
        <div class="detail-item">
          <span class="detail-label">Actividad (P<sub>act</sub>):</span>
          <span class="detail-value">{{ result.puntajeActividad }} pts</span>
        </div>
        <div class="detail-item">
          <span class="detail-label">Factor Seguridad (Î´):</span>
          <span class="detail-value">{{ result.factorSeguridad }}</span>
        </div>
      </div>
    </div>

    <div class="action-buttons">
      <button class="btn-rpg large" routerLink="/rutina">
        ğŸš€ Comenzar Mi Aventura
      </button>
      <button class="btn-secondary" (click)="result = null; currentStep = 1">
        ğŸ”„ Recalcular Perfil
      </button>
    </div>
  </div>
</div>