<div class="profile-container">
    <div *ngIf="loading" class="loading-overlay">
        <div class="spinner"></div>
        <p>Cargando estad√≠sticas del perfil...</p>
    </div>

    <div class="header">
        <div class="system-info">
            <span class="indicator"></span>
            CONEXI√ìN SEGURA ESTABLECIDA
        </div>
        <div class="title">
            <span class="highlight">PERFIL</span>
        </div>
        <div class="status">
            <span class="status-indicator"></span>
            ESTADO: <span class="online">EN L√çNEA</span>
        </div>
    </div>

    <div class="content">
        <div class="left-panel">
            <div class="user-card">
                <div class="avatar-container">
                    <div class="avatar"></div>
                    <div class="level-badge">LVL {{ level }}</div>
                </div>
                <div class="user-name">{{ name }}</div>
                <div class="user-class">NOMBRE DE USUARIO: @{{ username }}</div>
            </div>

            <div class="level-section">
                <div class="section-label">NIVEL TOTAL</div>
                <div class="level-number">{{ level }}</div>
            </div>

            <div class="level-section">
                <div class="section-label">NIVEL DE PERFIL</div>
                <div class="level-number">{{ profileLevel }}</div>
            </div>

            <div class="xp-section">
                <div class="xp-label">PROGRESO XP</div>
                <div class="xp-bar">
                    <div class="xp-fill" [style.width.%]="xpPercent"></div>
                </div>
                <div class="xp-text">
                    <span>{{ xpCurrent }} / {{ xpMax }}</span>
                </div>
            </div>

            <div class="stats-row">
                <div class="stat-card">
                    <div class="stat-icon fire">üî•</div>
                    <div class="stat-value">{{ dayStreak }}</div>
                    <div class="stat-label">RACHA DE D√çAS</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon trophy">üèÜ</div>
                    <div class="stat-value">{{ achievements }}</div>
                    <div class="stat-label">LOGROS</div>
                </div>
            </div>
        </div>

        <div class="right-panel">
            <div class="radar-section">
                <div class="section-header">
                    <div class="section-title">
                        PERFIL DEL USUARIO
                    </div>
                </div>

                <div class="radar-content">
                    <div class="profile-data-grid">
                        <!-- Datos Personales -->
                        <div class="data-section">
                            <div class="data-section-header">
                                <h3 class="data-section-title">üìã DATOS PERSONALES</h3>
                                <button class="edit-btn" (click)="openPersonalModal()">
                                    ‚úèÔ∏è Editar
                                </button>
                            </div>
                            <div class="data-row">
                                <span class="data-label">Nombre Completo:</span>
                                <span class="data-value">{{ user?.nombre }} {{ user?.apellido }}</span>
                            </div>
                            <div class="data-row">
                                <span class="data-label">Edad:</span>
                                <span class="data-value">{{ user?.edad }} a√±os</span>
                            </div>
                            <div class="data-row">
                                <span class="data-label">Email:</span>
                                <span class="data-value">{{ user?.email }}</span>
                            </div>
                        </div>

                        <!-- Datos F√≠sicos -->
                        <div class="data-section">
                            <div class="data-section-header">
                                <h3 class="data-section-title">üí™ DATOS F√çSICOS</h3>
                                <button class="edit-btn" (click)="openPhysicalModal()">
                                    ‚úèÔ∏è Editar
                                </button>
                            </div>
                            <div class="data-row">
                                <span class="data-label">Peso:</span>
                                <span class="data-value">{{ weight > 0 ? weight + ' kg' : 'N/A' }}</span>
                            </div>
                            <div class="data-row">
                                <span class="data-label">Altura:</span>
                                <span class="data-value">{{ height > 0 ? height + ' cm' : 'N/A' }}</span>
                            </div>
                            <div class="data-row">
                                <span class="data-label">IMC:</span>
                                <span class="data-value" [class.highlight]="imc > 0">{{ imc > 0 ? imc : 'N/A' }} - {{ imcCategory }}</span>
                            </div>
                            <div class="data-row">
                                <span class="data-label">% Grasa Corporal:</span>
                                <span class="data-value">{{ bodyFat > 0 ? (bodyFat | number:'1.1-1') + '%' : 'N/A' }}</span>
                            </div>
                        </div>

                        <!-- Experiencia y Actividad -->
                        <div class="data-section">
                            <div class="data-section-header">
                                <h3 class="data-section-title">üéØ EXPERIENCIA</h3>
                                <button class="edit-btn" (click)="openExperienceModal()">
                                    ‚úèÔ∏è Editar
                                </button>
                            </div>
                            <div class="data-row">
                                <span class="data-label">Nivel de Entrenamiento:</span>
                                <span class="data-value highlight">{{ trainingLevel }}</span>
                            </div>
                            <div class="data-row">
                                <span class="data-label">Meses de Experiencia:</span>
                                <span class="data-value">{{ experienceMonths }} meses</span>
                            </div>
                            <div class="data-row">
                                <span class="data-label">Nivel de Actividad:</span>
                                <span class="data-value">{{ activityLevel }}</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- MODAL: Editar Datos Personales -->
    <div class="modal-overlay" *ngIf="showPersonalModal" (click)="closeModals()">
        <div class="modal" (click)="$event.stopPropagation()">
            <div class="modal-header">
                <h2 class="modal-title">üìã Editar Datos Personales</h2>
                <button class="close-btn" (click)="closeModals()">‚úï</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">Nombre:</label>
                    <input type="text" class="form-input" [(ngModel)]="editPersonalData.nombre" [disabled]="saving">
                </div>
                <div class="form-group">
                    <label class="form-label">Apellido:</label>
                    <input type="text" class="form-input" [(ngModel)]="editPersonalData.apellido" [disabled]="saving">
                </div>
                <div class="form-group">
                    <label class="form-label">Edad:</label>
                    <input type="number" class="form-input" [(ngModel)]="editPersonalData.edad" [disabled]="saving">
                </div>
                <div class="form-group">
                    <label class="form-label">Email:</label>
                    <input type="email" class="form-input" [(ngModel)]="editPersonalData.email" [disabled]="saving">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-cancel" (click)="closeModals()" [disabled]="saving">Cancelar</button>
                <button class="btn-save" (click)="savePersonalData()" [disabled]="saving">
                    {{ saving ? 'Guardando...' : 'Guardar' }}
                </button>
            </div>
        </div>
    </div>

    <!-- MODAL: Editar Datos F√≠sicos -->
    <div class="modal-overlay" *ngIf="showPhysicalModal" (click)="closeModals()">
        <div class="modal" (click)="$event.stopPropagation()">
            <div class="modal-header">
                <h2 class="modal-title">üí™ Editar Datos F√≠sicos</h2>
                <button class="close-btn" (click)="closeModals()">‚úï</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">Peso (kg):</label>
                    <input type="number" step="0.1" class="form-input" [(ngModel)]="editPhysicalData.weight" [disabled]="saving">
                </div>
                <div class="form-group">
                    <label class="form-label">Altura (metros, ej: 1.83):</label>
                    <input type="number" step="0.01" class="form-input" [(ngModel)]="editPhysicalData.height" [disabled]="saving">
                    <small style="color: #94a3b8; font-size: 11px; margin-top: 4px;">
                        Ingresa tu altura en metros (ej: 1.83 para 183cm)
                    </small>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-cancel" (click)="closeModals()" [disabled]="saving">Cancelar</button>
                <button class="btn-save" (click)="savePhysicalData()" [disabled]="saving">
                    {{ saving ? 'Guardando...' : 'Guardar' }}
                </button>
            </div>
        </div>
    </div>

    <!-- MODAL: Editar Experiencia -->
    <div class="modal-overlay" *ngIf="showExperienceModal" (click)="closeModals()">
        <div class="modal" (click)="$event.stopPropagation()">
            <div class="modal-header">
                <h2 class="modal-title">üéØ Editar Experiencia</h2>
                <button class="close-btn" (click)="closeModals()">‚úï</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">Meses de Experiencia:</label>
                    <input type="number" class="form-input" [(ngModel)]="editExperienceData.experienceMonths" [disabled]="saving">
                </div>
                <div class="form-group">
                    <label class="form-label">Nivel de Actividad:</label>
                    <select class="form-select" [(ngModel)]="editExperienceData.nivelactividad" [disabled]="saving">
                        <option value="SEDENTARIO">Sedentario</option>
                        <option value="LIGERO">Ligero</option>
                        <option value="MODERADO">Moderado</option>
                        <option value="ACTIVO">Activo</option>
                        <option value="MUY_ACTIVO">Muy Activo</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-cancel" (click)="closeModals()" [disabled]="saving">Cancelar</button>
                <button class="btn-save" (click)="saveExperienceData()" [disabled]="saving">
                    {{ saving ? 'Guardando...' : 'Guardar' }}
                </button>
            </div>
        </div>
    </div>
